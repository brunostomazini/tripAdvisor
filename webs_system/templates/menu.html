{% extends "minimal.html"%}

{% block menu %}

<nav class="navbar navbar-expand-lg bg-body-tertiary">
<div class="container-fluid">
<a class="navbar-brand" href="#">TripAdvisor DEV-1</a>
<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarSupportedContent">
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
<a class="nav-link active" aria-current="page" href="{% url 'index'%}">Home</a>
</li>

{% if request.user.is_superuser %}

<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
Opções
</a>

        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="{% url 'tripAdvisor:listar_atracoes' %}">Atrações</a></li>
        </ul>
       
      </li>
      {% endif %}
    </ul>
    {% if user.is_authenticated %}
      <span class="navbar-text text-dark px-2">
        <a class="nav-link" href="{% url 'profile' %}">
          <i class="bi bi-person-fill"></i> {{ user.first_name }}
        </a></span>
        <div class="me-2"></div>
      <form action="{% url 'logout' %}" method="post">
      {% csrf_token %}
        <button class="btn btn-outline-danger btn" role="button" type="submit"><i class="bi bi-box-arrow-in-left"></i> Sair</button></form>
     
      {% else %}
       <a class="btn btn-outline-primary btn" role="button" href="{% url 'login' %}" ><i class="bi bi-box-arrow-in-right"></i> Entrar</a>
      {% endif %}

<!-- Configura o formulário de pesquisa para enviar o query 'q' -->

    <form class="d-flex" role="search" method="GET" action="{% url 'search' %}">
      <input class="form-control me-2" type="search" placeholder="Buscar local/atividade" aria-label="Search" name="q" value="{{ search_query|default:'' }}"/>
      <button class="btn btn-outline-success" type="submit">Buscar</button>
    </form>
  </div>

</div>
</nav>
{% endblock menu %}

{% block main %}

{% if search_query %}

<h3 class="text-center mb-4 text-light">Resultados da busca por: "<span class="text-warning">{{ search_query }}</span>"</h3>
{% else %}
<h2 class="text-center mb-4 text-warning fw-bold">Atrações Sugeridas </h2>
<p class="text-center text-light lead mb-5">Explore os locais e atividades mais populares da nossa comunidade.</p>
{% endif %}

{% if atracoes %}

<!-- NOVO LAYOUT: GRID DE CARDS RESPONSIVO -->

<!-- Define 1 coluna em telas pequenas (xs), 2 em médias (md) e 3 em grandes (lg) -->

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
{% for atracao in atracoes|slice:":5" %}
{% with model_name=atracao.get_model_name %}
<div class="col">
<div class="card h-100 bg-dark text-light border-warning shadow-lg">

<!-- Imagem Placeholder (Se você tiver a foto da atração, insira-a aqui) -->

{% comment %}
<img src="{% if atracao.foto %}{{ atracao.foto.url }}{% else %}https://placehold.co/600x400/171717/CCCCCC?text=Imagem+N%C3%A3o+Dispon%C3%ADvel{% endif %}" class="card-img-top" alt="Imagem da Atração" style="height: 200px; object-fit: cover;">
{% endcomment %}

<div class="card-body d-flex flex-column">
<h5 class="card-title text-warning fw-bold mb-1">
<!-- Exibe Nome (Local) ou Título (Atividade) -->
{% if atracao.nome %}{{ atracao.nome }}{% else %}{{ atracao.titulo }}{% endif %}
</h5>

<!-- Tipo/Localização e Badge do Tipo de Modelo -->
<p class="card-text mb-3">
    <span class="badge bg-secondary me-1">
        <i class="bi bi-geo-alt me-1"></i>
        
        <!-- LÓGICA ATUALIZADA: Diferencia a exibição com base no tipo de modelo -->
        {% if model_name == 'local' %}
            Local ({% if atracao.endereco %}{{ atracao.endereco.cidade }}{% else %}Sem cidade{% endif %})
        {% elif model_name == 'atividade' %}
            Atividade ({% if atracao.categoria %}{{ atracao.categoria.nome }}{% else %}Sem categoria{% endif %})
        {% else %}
            N/A
        {% endif %}
        
    </span>
    <!-- Badge que informa se é Local ou Atividade -->
    <span class="badge bg-info text-dark fw-bold">{{ model_name|capfirst }}</span>
</p>

<!-- Descrição Curta (USANDO atracao.informacoes) -->
<p class="card-text text-muted small flex-grow-1">
    {% if atracao.informacoes %}
        {{ atracao.informacoes|truncatechars:120 }}
    {% else %}
        Clique para ver mais detalhes e avaliações completas desta atração.
    {% endif %}
</p>

<!-- Botão de Detalhes -->
<div class="mt-3 text-end">
    <a class="btn btn-sm btn-outline-warning" role="button"
       href="{% url 'tripAdvisor:'|add:model_name|add:'_detail' pk=atracao.pk %}">
        <i class="bi bi-eye me-1"></i> Detalhar
    </a>
</div>


</div>

</div>
</div>
{% endwith %}

{% endfor %}

</div>

<!-- Mensagem de paginação (Se houver mais de 5 resultados) -->

{% if atracoes|length > 5 %}

<div class="text-center mt-5">
<p class="text-muted">Mostrando as primeiras 5 atrações. Use a paginação para ver mais.</p>
</div>
{% endif %}

{% else %}

<div class="alert alert-warning text-center" role="alert">
{% if search_query %}
Nenhuma atração (Local ou Atividade) encontrada para o termo "{{ search_query }}".
{% else %}
Nenhuma atração (Local ou Atividade) encontrada no momento.
{% endif %}
</div>
{% endif %}

{% endblock main %}